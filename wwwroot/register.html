<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨å†Œ - æ¸¸æˆé“å…·äº¤æ˜“å¹³å°</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container" id="app">

        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">ğŸ’</span>
                    <span class="logo-text">æ³¨å†Œ</span>
                </div>
                <button class="theme-toggle-btn" onclick="toggleTheme()">ğŸŒ“</button>
            </div>
        </header>

        <!-- æ³¨å†Œè¡¨å• -->
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">åˆ›å»ºè´¦æˆ·</h2>
                <p class="auth-subtitle">æ³¨å†Œæˆä¸ºå¹³å°ä¼šå‘˜</p>

                <div class="auth-form">

                    <div class="form-group">
                        <label>æ˜µç§°</label>
                        <input type="text"
                               v-model="nickname"
                               placeholder="æ˜µç§°"
                               minlength="2"
                               maxlength="20"
                               required>
                    </div>

                    <div class="form-group">
                        <label>è´¦å·</label>
                        <input type="text"
                               v-model="username"
                               placeholder="è´¦å·"
                               minlength="3"
                               maxlength="20"
                               required>
                    </div>

                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password"
                               v-model="password"
                               placeholder="å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"
                               minlength="6"
                               required>
                    </div>

                    <div class="form-group">
                        <label>ç¡®è®¤å¯†ç </label>
                        <input type="password"
                               v-model="confirmPwd"
                               placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
                               minlength="6"
                               required>
                    </div>

                    <button type="button"
                            class="btn btn-primary auth-submit"
                            v-on:click="register">
                        æ³¨å†Œ
                    </button>
                </div>

                <div class="auth-footer">
                    <span>å·²æœ‰è´¦æˆ·ï¼Ÿ</span>
                    <a href="login.html" class="link-text">ç«‹å³ç™»å½•</a>
                </div>
            </div>
        </div>
    </div>


    <script src="js/tinyVue.js"></script>
    <script src="js/common.js"></script>

    <!-- æ³¨å†Œé€»è¾‘ + ä¸»é¢˜åˆ‡æ¢ -->
    <script>

        // ä½¿ç”¨ tinyVue
        const vm = tinyVue({
            el: "#app",
            data: {
                username: "",
                nickname: "",
                password: "",
                confirmPwd: ""
            }
        });

        // æ³¨å†Œæ–¹æ³•
        vm.register = async function () {

            // å‰ç«¯æ ¡éªŒ
            if (!vm.username || vm.username.length < 3) {
                alert("è´¦å·è‡³å°‘ 3 ä½");
                return;
            }
            if (!vm.nickname || vm.nickname.length < 2) {
                alert("æ˜µç§°è‡³å°‘ 2 ä½");
                return;
            }
            if (!vm.password || vm.password.length < 6) {
                alert("å¯†ç è‡³å°‘ 6 ä½");
                return;
            }
            if (vm.password !== vm.confirmPwd) {
                alert("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");
                return;
            }

            // è°ƒç”¨åç«¯æ¥å£
            const res = await fetch("/api/auth/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    login_name: vm.username,
                    nickname: vm.nickname,
                    login_pwd: vm.password
                })
            });

            const data = await res.json();

            if (data.code !== 0) {
                alert(data.msg);
                return;
            }

            alert("æ³¨å†ŒæˆåŠŸï¼å³å°†è·³è½¬ç™»å½•é¡µé¢");
            location.href = "login.html";
        };
    </script>

    <script>
        (function () {
            // åŸ‹ç‚¹æ¥å£
            const url = "/api/stat/page-view";
            const token = localStorage.getItem("token");
            // é¡µé¢æ•°æ®
            const data = {
                page: "æ³¨å†Œé¡µé¢",
                referrer: document.referrer,
                ua: navigator.userAgent,
                ts: Date.now()
            };

            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: data ? JSON.stringify(data) : null
            });
        })();
    </script>
</body>

</html>
